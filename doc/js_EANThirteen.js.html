<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/EANThirteen.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: js/EANThirteen.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @type {number} logitude of bar code
 * 
 */
const EAN_THIRTEEN_LENGTH = 13;

/**
 * 
 * This is the load function, the DOM selectors are loaded and events are added to validate the credit 
 * card number entered by the user.
 * 
 */
window.onload = () => {
    $form = document.querySelector('.ean-form');
    $form.addEventListener('submit', (event) => {
        event.preventDefault();
        let form = new FormData($form);
        let barCode = form.get('barCode');
        let originalBarCode = barCode;

        inputValue = document.querySelector('.barCode');
        inputValue.value = barCode = padLeft(barCode);

        let result = document.querySelector('.result');
        if (barCode == 0) result.innerHTML = ''
        else (barCode.length > EAN_THIRTEEN_LENGTH) ? result.innerHTML = `&lt;label style="color:#991B1B">longitud mayor a la esperada&lt;/label>` : result.innerHTML = this.verifyEANCode(barCode, originalBarCode);
    })
}


/**
 * main verification barcode function
 * 
 * @param {string} barCode entered barcode by user
 * @param {string} originalBarCode entered barcode by user
 * @returns result of executed verifyCheckDigit function
 */
function verifyEANCode(barCode, originalBarCode) {
    if (barCode.includes(' ')) barCode = removeSpaces(barCode);
    if (barCode.length &lt; 13) barCode = padLeft(barCode);

    let checkDigit = barCode.charAt(EAN_THIRTEEN_LENGTH - 1);
    return verifyCheckDigit(checkDigit, barCode) == 'Si' ? `${verifyCheckDigit(checkDigit, barCode)} ${verifyCountry(originalBarCode, countries)}` : `${verifyCheckDigit(checkDigit, barCode)}`;
}


/**
 * 
 * @param {String} barCode entered barcode by user
 * @returns if the array is shorter whith EAN_THIRTEEN_LENGTH it returns a string with leading zeros otherwise it returns the same array
 */
function padLeft(barCode) {
    return (barCode.toString().length &lt; EAN_THIRTEEN_LENGTH) ? padLeft('0' + barCode) : barCode;
}


/**
 *  This function calculates the verification digit and compares it with the code entered to see if it is valid or not
 * 
 * @param {Number} checkDigit verification digit of the barcode entered
 * @param {string} barCode barcode entered by user
 * @returns returns 'Si' if the barcode is valid otherwise returns 'No' or if the code is zero returns empty
 */
function verifyCheckDigit(checkDigit, barCode) {
    let sum = sumDigits(barCode);
    let baseSum = sum.oddSum + sum.evenSum * 3;
    let calculatedDigit = ((roundedSum(sum) - baseSum) >= 10) ? 0 : (roundedSum(sum) - baseSum);

    if (baseSum == 0) return '';
    return (checkDigit == calculatedDigit) ? 'Si' : 'No';
}

/**
 * 
 * @param {String} originalBarCode barcode entered by user
 * @param {Array} countries list of countries available for validation
 * @returns If the country corresponding to the code in the barcode is in the list, it returns it, 
 * otherwise it returns unknown
 */
function verifyCountry(originalBarCode, countries) {
    let country = countries.map(country => {
        if (originalBarCode.slice(0, country.code.toString().length).includes(country.code)) return country.name
    }).filter(Boolean);
    return (country.length !== 0) ? country : 'Desconocido';
}

/**
 * 
 * @param {String} barCode entered barcode by user
 * @returns object whith sum of digits in odd and even positions of the barcode
 */
function sumDigits(barCode) {
    let sum = { oddSum: 0, evenSum: 0 };

    for (let index = 0; index &lt; barCode.length - 1; index++) {
        if (index % 2 == 0) sum.oddSum += Number(barCode[index])
        else sum.evenSum += Number(barCode[index])
    }
    return sum;
}

/**
 * 
 * @param {Object} sum  sum of digits in odd and even positions of the barcode
 * @returns Number ceil
 */
function roundedSum(sum) {
    return Math.ceil((sum.oddSum + sum.evenSum * 3) / 10) * 10;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#card">card</a></li><li><a href="global.html#CARD_CODE_LENGTH">CARD_CODE_LENGTH</a></li><li><a href="global.html#countries">countries</a></li><li><a href="global.html#devURLBase">devURLBase</a></li><li><a href="global.html#EAN_THIRTEEN_LENGTH">EAN_THIRTEEN_LENGTH</a></li><li><a href="global.html#padLeft">padLeft</a></li><li><a href="global.html#redirectTo">redirectTo</a></li><li><a href="global.html#removeSpaces">removeSpaces</a></li><li><a href="global.html#roundedSum">roundedSum</a></li><li><a href="global.html#sumDigits">sumDigits</a></li><li><a href="global.html#sumDigitsNumber">sumDigitsNumber</a></li><li><a href="global.html#URLBase">URLBase</a></li><li><a href="global.html#validateCreditCard">validateCreditCard</a></li><li><a href="global.html#verifyCardType">verifyCardType</a></li><li><a href="global.html#verifyCheckDigit">verifyCheckDigit</a></li><li><a href="global.html#verifyCountry">verifyCountry</a></li><li><a href="global.html#verifyEANCode">verifyEANCode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Aug 17 2021 22:34:26 GMT-0500 (Colombia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
